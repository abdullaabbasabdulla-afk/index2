<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<title>اختبار سرعة العمليات الحسابية (بدون حد زمني)</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #eef2f3;
    text-align: center;
    padding: 20px;
  }
  h1 {
    color: #333;
  }
  .problem {
    font-size: 36px;
    margin: 20px 0;
  }
  input {
    font-size: 24px;
    padding: 6px;
    width: 180px;
    text-align: center;
  }
  button {
    font-size: 18px;
    padding: 10px 18px;
    margin: 15px 10px;
    cursor: pointer;
  }
  #timer {
    font-size: 24px;
    margin-top: 15px;
  }
  #stats {
    font-size: 20px;
    margin-top: 15px;
  }
  #feedback {
    margin-top: 15px;
    font-size: 22px;
    min-height: 30px;
  }
</style>
</head>
<body>

<h1>اختبار سرعة العمليات الحسابية (بدون حد زمني)</h1>

<div id="timer">الوقت: ٠ ثانية</div>

<div class="problem" id="problemText"></div>
<input type="number" id="answerInput" placeholder="أدخل الإجابة" disabled />

<br />
<button id="startBtn" onclick="startTest()">ابدأ الاختبار</button>
<button id="endBtn" onclick="endTest()" disabled>إنهاء الاختبار</button>

<div id="feedback"></div>

<div id="stats">
  صحيحة: <span id="correctCount">٠</span> |
  خاطئة: <span id="wrongCount">٠</span>
</div>

<script>
  // لتحويل أرقام انجليزية إلى عربية
  function toArabicDigits(num) {
    return String(num).replace(/\d/g, d => '٠١٢٣٤٥٦٧٨٩'[d]);
  }

  let correct = 0;
  let wrong = 0;
  let secondsElapsed = 0;
  let timerInterval;
  let currentProblem = {};
  let testRunning = false;

  function randomInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

  function generateProblem() {
    const operators = ['+', '-', '×', '÷'];
    const op = operators[randomInt(0, operators.length - 1)];
    let num1, num2, answer;

    switch(op) {
      case '+':
        num1 = randomInt(1, 1000000);
        num2 = randomInt(1, 1000000);
        answer = num1 + num2;
        break;
      case '-':
        num1 = randomInt(1, 1000000);
        num2 = randomInt(1, num1);
        answer = num1 - num2;
        break;
      case '×':
        num1 = randomInt(1, 1000);
        num2 = randomInt(1, 99); // العدد الثاني مكوّن من رقمين كحد أقصى
        answer = num1 * num2;
        break;
      case '÷':
        num2 = randomInt(1, 99); // العدد الثاني مكوّن من رقمين كحد أقصى
        answer = randomInt(1, 1000);
        num1 = num2 * answer;
        break;
    }

    currentProblem = { num1, num2, op, answer };
    document.getElementById('problemText').textContent =
      `${toArabicDigits(num1)} ${op} ${toArabicDigits(num2)} = ؟`;
    document.getElementById('answerInput').value = '';
    document.getElementById('answerInput').focus();
  }

  function checkAnswer() {
    if (!testRunning) return;
    const userAnswer = Number(document.getElementById('answerInput').value.trim());
    if (userAnswer === currentProblem.answer) {
      correct++;
      document.getElementById('feedback').textContent = 'إجابة صحيحة ✅';
    } else {
      wrong++;
      document.getElementById('feedback').textContent =
        `خطأ ❌ — الإجابة الصحيحة: ${toArabicDigits(currentProblem.answer)}`;
    }
    updateStats();
    generateProblem();
  }

  function updateStats() {
    document.getElementById('correctCount').textContent = toArabicDigits(correct);
    document.getElementById('wrongCount').textContent = toArabicDigits(wrong);
  }

  function startTest() {
    correct = 0;
    wrong = 0;
    secondsElapsed = 0;
    testRunning = true;
    updateStats();
    document.getElementById('startBtn').disabled = true;
    document.getElementById('endBtn').disabled = false;
    document.getElementById('answerInput').disabled = false;
    document.getElementById('feedback').textContent = '';
    generateProblem();

    document.getElementById('timer').textContent = `الوقت: ${toArabicDigits(secondsElapsed)} ثانية`;

    timerInterval = setInterval(() => {
      secondsElapsed++;
      document.getElementById('timer').textContent = `الوقت: ${toArabicDigits(secondsElapsed)} ثانية`;
    }, 1000);
  }

  function endTest() {
    testRunning = false;
    clearInterval(timerInterval);
    document.getElementById('startBtn').disabled = false;
    document.getElementById('endBtn').disabled = true;
    document.getElementById('answerInput').disabled = true;
    document.getElementById('problemText').textContent = 'انتهى الاختبار ⏳';
    document.getElementById('feedback').textContent =
      `لقد أجبت ${toArabicDigits(correct)} صحيحة و ${toArabicDigits(wrong)} خاطئة في ${toArabicDigits(secondsElapsed)} ثانية.`;
  }

  document.getElementById('answerInput').addEventListener('keydown', function(e) {
    if (e.key === 'Enter') {
      if (testRunning) checkAnswer();
    }
  });
</script>

</body>
</html>